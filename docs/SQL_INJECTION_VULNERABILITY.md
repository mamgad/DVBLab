# SQL Injection Vulnerability in Transaction Search

This documentation explains the SQL Injection vulnerability that has been intentionally implemented in the transaction search feature of the Vulnerable Banking Application.

## Overview

The transaction search feature allows users to search for their transactions by description. However, the implementation contains a deliberate vulnerability that allows for SQL Injection attacks.

## Location of the Vulnerability

The vulnerability exists in the `search_transactions` function in `backend/routes/transaction_routes.py`:

```python
@transaction_bp.route('/api/transactions/search', methods=['GET'])
@token_required
def search_transactions(current_user):
    search_term = request.args.get('description', '')
    
    # VULNERABLE CODE: Direct string concatenation in SQL query
    # This is deliberately vulnerable to SQL injection for educational purposes
    query = f"SELECT * FROM transaction WHERE (sender_id = {current_user.id} OR receiver_id = {current_user.id}) AND description LIKE '%{search_term}%'"
    
    result = db.session.execute(query)
    transactions = result.fetchall()
    
    transaction_list = []
    for t in transactions:
        transaction_list.append({
            'id': t[0],
            'sender_id': t[1],
            'receiver_id': t[2], 
            'amount': float(t[3]),
            'description': t[4],
            'status': t[5],
            'created_at': t[6],
            'completed_at': t[7]
        })
    
    return jsonify(transaction_list)
```

## Why It's Vulnerable

The vulnerability exists because the user-provided `search_term` is directly incorporated into the SQL query without any sanitization or parameter binding. This means that an attacker can manipulate the input to modify the query's structure and potentially:

1. Access unauthorized data
2. Bypass authentication
3. Extract database schema information
4. In some cases, modify or delete data

## Example Exploitation

### Normal Use Case:
If a user searches for "rent", the following query is executed:
```sql
SELECT * FROM transaction 
WHERE (sender_id = 1 OR receiver_id = 1) 
AND description LIKE '%rent%'
```

### Malicious Input:
If an attacker inputs `' OR '1'='1` as the search term, the query becomes:
```sql
SELECT * FROM transaction 
WHERE (sender_id = 1 OR receiver_id = 1) 
AND description LIKE '%' OR '1'='1%'
```

Since `'1'='1'` is always true, this condition would bypass the intended filtering.

### More Advanced Attacks:
An attacker could use techniques like:
- UNION attacks to join additional queries
- Comment injection using `--` to modify query logic
- Subqueries to extract information from other tables

## How to Fix This Vulnerability

In a real application, this vulnerability should be fixed by using parameterized queries:

```python
# SAFE VERSION:
search_term = request.args.get('description', '')
query = "SELECT * FROM transaction WHERE (sender_id = :user_id OR receiver_id = :user_id) AND description LIKE :term"
result = db.session.execute(query, {
    "user_id": current_user.id,
    "term": f"%{search_term}%"
})
```

By using parameterized queries, the database engine handles the user input as data rather than as part of the SQL command, effectively preventing SQL injection.

## Educational Purpose

This vulnerability has been deliberately implemented for educational purposes to demonstrate:

1. How SQL injection vulnerabilities can be introduced in code
2. The potential impact of such vulnerabilities
3. How to identify SQL injection vulnerabilities in code reviews
4. Proper techniques to prevent SQL injection

**Warning**: This vulnerability should never be implemented in production systems or real applications. 